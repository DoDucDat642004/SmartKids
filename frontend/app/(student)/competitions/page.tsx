"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import {
  Trophy,
  Calendar,
  Users,
  Star,
  Medal,
  Zap,
  Lock,
  Gift,
  ArrowRight,
  BarChart3,
  Clock,
} from "lucide-react";

// --- TYPES ---
type CompStatus = "HAPPENING" | "UPCOMING" | "ENDED";

interface Competition {
  id: string;
  title: string;
  type: "QUIZ" | "SPEAKING";
  startTime: string;
  endTime: string;
  participants: number;
  status: CompStatus;
  reward: string;
  myRank?: number;
  myScore?: number;
  imageBg: string;
}

// --- MOCK DATA ---
const COMPETITIONS: Competition[] = [
  {
    id: "C01",
    title: "ƒê·∫•u Tr∆∞·ªùng T·ª´ V·ª±ng: Unit 5",
    type: "QUIZ",
    startTime: "20:00 H√¥m nay",
    endTime: "21:00 H√¥m nay",
    participants: 142,
    status: "HAPPENING",
    reward: "üèÜ Huy hi·ªáu V√†ng + 500 XP",
    imageBg: "bg-gradient-to-br from-indigo-500 to-purple-600",
  },
  {
    id: "C02",
    title: "Th·ª≠ th√°ch Speaking: Holiday",
    type: "SPEAKING",
    startTime: "09:00, 25/11",
    endTime: "18:00, 27/11",
    participants: 56,
    status: "UPCOMING",
    reward: "ü•à Huy hi·ªáu B·∫°c + 300 XP",
    imageBg: "bg-gradient-to-br from-blue-400 to-cyan-500",
  },
  {
    id: "C03",
    title: "Rung Chu√¥ng V√†ng Tu·∫ßn 3",
    type: "QUIZ",
    startTime: "ƒê√£ k·∫øt th√∫c",
    endTime: "15/11/2023",
    participants: 200,
    status: "ENDED",
    reward: "üéÅ Voucher kh√≥a h·ªçc",
    myRank: 5,
    myScore: 980,
    imageBg: "bg-slate-600",
  },
];

export default function StudentCompetitionsPage() {
  const router = useRouter();
  const [activeTab, setActiveTab] = useState<"ACTIVE" | "HISTORY">("ACTIVE");

  const activeList = COMPETITIONS.filter((c) => c.status !== "ENDED");
  const historyList = COMPETITIONS.filter((c) => c.status === "ENDED");

  const goToRegister = (compId: string) => {
    router.push(`/competitions/${compId}/register`);
  };

  const goToPlay = (compId: string) => {
    router.push(`/competitions/${compId}/play`);
  };

  const goToLeaderboard = (compId: string) => {
    router.push(`/competitions/${compId}/leaderboard`);
  };

  return (
    <div className="min-h-screen bg-[#F0F4F8] font-sans">
      <div className="max-w-7xl mx-auto p-4 md:p-8 pb-24">
        {/* 1. HEADER HERO */}
        <div className="bg-white rounded-3xl p-6 md:p-10 mb-8 border border-slate-200 shadow-sm relative overflow-hidden">
          {/* Background decoration */}
          <div className="absolute top-0 right-0 w-96 h-96 bg-yellow-100 rounded-full blur-3xl opacity-50 -translate-y-1/2 translate-x-1/2 pointer-events-none"></div>

          <div className="relative z-10 flex flex-col md:flex-row justify-between items-center gap-8">
            <div className="flex-1">
              <div className="flex items-center gap-3 mb-3">
                <span className="bg-orange-100 text-orange-600 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider flex items-center gap-1 shadow-sm">
                  <Zap size={14} fill="currentColor" /> ƒê·∫•u tr∆∞·ªùng
                </span>
              </div>
              <h1 className="text-3xl md:text-4xl lg:text-5xl font-black text-slate-900 mb-3 tracking-tight">
                Th·ª≠ Th√°ch B·∫£n Th√¢n üöÄ
              </h1>
              <p className="text-slate-500 text-base md:text-lg max-w-xl leading-relaxed">
                Tham gia c√°c cu·ªôc thi ƒë·ªÉ t√≠ch l≈©y ƒëi·ªÉm th∆∞·ªüng, leo b·∫£ng x·∫øp h·∫°ng
                v√† nh·∫≠n nh·ªØng ph·∫ßn qu√† h·∫•p d·∫´n!
              </p>
            </div>

            {/* User Stats Card - Compact on mobile, wider on desktop */}
            <div className="bg-slate-900 text-white p-6 rounded-2xl flex flex-wrap md:flex-nowrap items-center justify-center gap-6 shadow-xl shadow-slate-200 w-full md:w-auto min-w-[320px]">
              <div className="text-center flex-1">
                <div className="text-yellow-400 mb-2 flex justify-center">
                  <Trophy size={28} />
                </div>
                <div className="text-2xl font-black leading-none mb-1">03</div>
                <div className="text-[10px] text-slate-400 uppercase font-bold tracking-wider">
                  Chi·∫øn th·∫Øng
                </div>
              </div>
              <div className="w-[1px] h-10 bg-slate-700 hidden md:block"></div>
              <div className="text-center flex-1">
                <div className="text-blue-400 mb-2 flex justify-center">
                  <Star size={28} />
                </div>
                <div className="text-2xl font-black leading-none mb-1">
                  1250
                </div>
                <div className="text-[10px] text-slate-400 uppercase font-bold tracking-wider">
                  T·ªïng XP
                </div>
              </div>
              <div className="w-[1px] h-10 bg-slate-700 hidden md:block"></div>
              <div className="text-center flex-1">
                <div className="text-green-400 mb-2 flex justify-center">
                  <Medal size={28} />
                </div>
                <div className="text-2xl font-black leading-none mb-1">#12</div>
                <div className="text-[10px] text-slate-400 uppercase font-bold tracking-wider">
                  Rank Tu·∫ßn
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* 2. TABS */}
        <div className="flex gap-4 mb-8 overflow-x-auto no-scrollbar pb-2">
          <button
            onClick={() => setActiveTab("ACTIVE")}
            className={`px-6 py-3 mt-1 rounded-full font-bold text-sm transition-all duration-300 whitespace-nowrap flex items-center gap-2 
      ${
        activeTab === "ACTIVE"
          ? "bg-blue-600 text-white shadow-lg shadow-blue-500/30 -translate-y-0.5" // Active: B√≥ng m√†u xanh, n·ªïi l√™n
          : "bg-white text-slate-500 border border-slate-200 hover:bg-slate-50 hover:text-slate-700 hover:border-slate-300" // Inactive: Vi·ªÅn x√°m nh·∫π
      }`}
          >
            <Zap
              size={18}
              className={activeTab === "ACTIVE" ? "fill-current" : ""}
            />
            ƒêang di·ªÖn ra
          </button>

          <button
            onClick={() => setActiveTab("HISTORY")}
            className={`px-6 py-3 mt-1 rounded-full font-bold text-sm transition-all duration-300 whitespace-nowrap flex items-center gap-2 
      ${
        activeTab === "HISTORY"
          ? "bg-blue-600 text-white shadow-lg shadow-blue-500/30 -translate-y-0.5"
          : "bg-white text-slate-500 border border-slate-200 hover:bg-slate-50 hover:text-slate-700 hover:border-slate-300"
      }`}
          >
            <Clock size={18} />
            L·ªãch s·ª≠ tham gia
          </button>
        </div>

        {/* 3. CONTENT GRID */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {/* === ACTIVE TAB === */}
          {activeTab === "ACTIVE" &&
            activeList.map((comp) => (
              <div
                key={comp.id}
                className="group bg-white rounded-3xl border border-slate-200 overflow-hidden hover:shadow-2xl hover:shadow-blue-100 hover:-translate-y-1 transition-all duration-300 flex flex-col h-full"
              >
                {/* Card Header */}
                <div
                  className={`h-36 ${comp.imageBg} relative p-6 flex flex-col justify-between`}
                >
                  <div className="flex justify-between items-start">
                    <span className="bg-black/20 backdrop-blur-md text-white px-3 py-1 rounded-lg text-xs font-bold flex items-center gap-1.5 border border-white/10">
                      {comp.type === "QUIZ" ? "üß© Quiz" : "üéôÔ∏è Speaking"}
                    </span>
                    {comp.status === "HAPPENING" && (
                      <span className="bg-red-500 text-white px-3 py-1 rounded-full text-[10px] font-black uppercase animate-pulse flex items-center gap-1.5 shadow-sm">
                        <span className="w-2 h-2 bg-white rounded-full block animate-ping" />{" "}
                        Live
                      </span>
                    )}
                  </div>
                  <h3 className="text-white font-black text-xl leading-tight shadow-sm drop-shadow-md pr-4">
                    {comp.title}
                  </h3>
                </div>

                {/* Card Body */}
                <div className="p-6 flex-1 flex flex-col">
                  <div className="space-y-5 mb-8">
                    {/* Time */}
                    <div className="flex items-start gap-4">
                      <div className="w-10 h-10 rounded-2xl bg-blue-50 text-blue-600 flex items-center justify-center shrink-0">
                        <Calendar size={20} />
                      </div>
                      <div>
                        <p className="text-[10px] font-bold text-slate-400 uppercase tracking-wide">
                          Th·ªùi gian
                        </p>
                        <p className="text-sm font-bold text-slate-700">
                          {comp.startTime}
                        </p>
                      </div>
                    </div>

                    {/* Reward */}
                    <div className="flex items-start gap-4">
                      <div className="w-10 h-10 rounded-2xl bg-orange-50 text-orange-600 flex items-center justify-center shrink-0">
                        <Gift size={20} />
                      </div>
                      <div>
                        <p className="text-[10px] font-bold text-slate-400 uppercase tracking-wide">
                          Ph·∫ßn th∆∞·ªüng
                        </p>
                        <p className="text-sm font-bold text-orange-600">
                          {comp.reward}
                        </p>
                      </div>
                    </div>

                    {/* Participants & Live Leaderboard */}
                    <div className="flex items-center justify-between pt-2 border-t border-slate-50">
                      <div className="flex items-center gap-3">
                        <div className="flex -space-x-2">
                          {[1, 2, 3].map((i) => (
                            <div
                              key={i}
                              className="w-6 h-6 rounded-full bg-slate-200 border-2 border-white"
                            ></div>
                          ))}
                        </div>
                        <p className="text-xs font-bold text-slate-500">
                          +{comp.participants} tham gia
                        </p>
                      </div>

                      {comp.status === "HAPPENING" && (
                        <button
                          onClick={() => goToLeaderboard(comp.id)}
                          className="text-xs font-bold text-blue-600 hover:text-blue-700 hover:bg-blue-50 px-3 py-1.5 rounded-lg transition flex items-center gap-1"
                        >
                          <BarChart3 size={14} /> BXH Live
                        </button>
                      )}
                    </div>
                  </div>

                  {/* Footer Action */}
                  <div className="mt-auto">
                    {comp.status === "HAPPENING" ? (
                      <button
                        onClick={() => goToPlay(comp.id)}
                        className="w-full py-3.5 bg-blue-600 hover:bg-blue-700 text-white rounded-2xl font-bold shadow-lg shadow-blue-200 transition flex items-center justify-center gap-2 group-hover:scale-[1.02] active:scale-95"
                      >
                        Tham gia ngay <ArrowRight size={20} />
                      </button>
                    ) : (
                      <button
                        onClick={() => goToRegister(comp.id)}
                        className="w-full py-3.5 bg-slate-100 hover:bg-slate-200 text-slate-600 rounded-2xl font-bold transition flex items-center justify-center gap-2 active:scale-95"
                      >
                        <Lock size={18} /> ƒêƒÉng k√Ω tr∆∞·ªõc
                      </button>
                    )}
                  </div>
                </div>
              </div>
            ))}

          {/* === HISTORY TAB === */}
          {activeTab === "HISTORY" &&
            historyList.map((comp) => (
              <div
                key={comp.id}
                className="bg-white rounded-3xl border border-slate-200 p-6 flex flex-col gap-5 transition hover:shadow-lg"
              >
                <div className="flex justify-between items-start">
                  <div>
                    <h3 className="font-bold text-slate-800 text-lg mb-1 line-clamp-1">
                      {comp.title}
                    </h3>
                    <p className="text-xs text-slate-400">
                      K·∫øt th√∫c: {comp.endTime}
                    </p>
                  </div>
                  <span className="bg-slate-100 text-slate-500 px-3 py-1 rounded-lg text-[10px] font-bold uppercase tracking-wide">
                    ƒê√£ k·∫øt th√∫c
                  </span>
                </div>

                <div className="bg-slate-50 p-5 rounded-2xl border border-slate-100">
                  <div className="flex justify-between items-center mb-3">
                    <span className="text-xs font-bold text-slate-500 uppercase">
                      H·∫°ng c·ªßa b·∫°n
                    </span>
                    <span
                      className={`text-base font-black ${
                        comp.myRank && comp.myRank <= 3
                          ? "text-yellow-600"
                          : "text-slate-700"
                      }`}
                    >
                      #{comp.myRank}
                    </span>
                  </div>

                  {/* Progress Bar Visual */}
                  <div className="relative h-2 w-full bg-slate-200 rounded-full overflow-hidden">
                    <div
                      className="absolute top-0 left-0 h-full bg-blue-600 rounded-full"
                      style={{ width: "80%" }} // Mock progress
                    ></div>
                  </div>

                  <div className="flex justify-between items-center mt-2">
                    <span className="text-[10px] text-slate-400 font-medium">
                      ƒêi·ªÉm s·ªë
                    </span>
                    <span className="text-xs text-blue-600 font-bold">
                      {comp.myScore} XP
                    </span>
                  </div>
                </div>

                <button
                  onClick={() => goToLeaderboard(comp.id)}
                  className="w-full py-3 border border-slate-200 text-slate-600 font-bold rounded-2xl hover:bg-slate-50 text-sm flex items-center justify-center gap-2 transition active:scale-95"
                >
                  <Trophy size={16} className="text-yellow-500" /> Xem b·∫£ng x·∫øp
                  h·∫°ng
                </button>
              </div>
            ))}
        </div>
      </div>
    </div>
  );
}
